# h1 Hacker Warmup 

#### Tehtävät saa aloittaa vasta, kun on hyväksynyt kurssin säännöt. Mitään ulkopuolisia koneita ei saa porttiskannata ilman lupaa. Irrota tarvittaessa virtuaalikone Internetistä kokeilujen ajaksi. Tässä kotitehtävässä porttiskannaukset tehdään ensisijaisesti localhost-osoitteella. 

Tehtävän määräaika on 24 h ennen seuraavaa oppituntia, eli pääsiäisen takia vasta 2024-04-07 w14 su 08:15. Kannattaa aloittaa tehtävien teko saman tien, jotta saa hakkeroida rauhassa.

Tässä harjoituksessa on tiedustelua ja lämmittelyä. Pääset lukemaan sen kuuluisan paperin kybertappoketjusta. Tutustut O'Reilly Learning -alustan videokursseihin. Kokeilet montaa harjoitusympäristöä. Jos hakkerointi sujuu jo, näillä samoilla alustoilla voit harjoitella myös kurssin ulkopuolella.

--------------------------------------------------------------

### x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.) 
#### - € Santos et al: The Art of Hacking (Video Collection): [..] [4.3 Surveying Essential Tools for Active Reconnaissance](https://www.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/). Sisältää porttiskannauksen. 5 videota, yhteensä noin 20 min. 
- Active Reconnaissance = Aktiivinen tiedustelu, jota esimerksiksi porttiskannaus on. Voidaan myös kutsua  joskus nimellä "Scanning phase - skannaus vaihe"
- Aktiivisessa tiedustelussa kohde verkkoon lähetetään paketteja, toisin kuin passiivisessa tiedustelussa. 
- Mikäli kohdeverkossa ollaan hereillä on aktiivinen tiedustelu (portti skannaus) helppo huomata monitoroimalla ja katsomalla logitiedostoja. Aktiivinen tiedustelu jättää jäljet ja herättää huomiota, toisin kuin passiivinen tiedustelu.
- Mitä enemmän skannausta suoritetaan, sitä enemmän se myös pitää "ääntä" ja herättää huomiota.
- Kolme vaihetta: 1. Portti skannaus, 2. Verkkopalvelun läpikäynti ja 3. Haavoittuvuuksien skannaus. 
- Porttiskannauksen apuvälineitä: [Nmap](https://nmap.org/) Yleisin ja monipuolisin vaihtoehto, ollut olemassa jo pitkään. (yli 20 vuotta.) ja [Masscan](https://github.com/robertdavidgraham/masscan) Nopein skanneri. 
- Verkkopalvelun läpikäyntiin työkaluksi tarjotaan: [EyeWitness](https://github.com/ChrisTruncer/EyeWitness-Ruby) Helpottaa erityisesti isojen palveluiden läpikäymistä ja kohteen priorisointia.
- Haavoittuvuuksien skannausta voidaan sanoa olevan kahdenlaista. Network vulnerability eli Tietoverkosta tapahtuvaa ja Web vulnerability eli internetissä tapahtuvaa skannausta. Molemmille löytyy omat työkalut. 
- Network vulnerability työkalut: OpenVAS, Nessus, Nexpose, Qualys, Nmap
- Web vulnerability työkalut: Nikto, WPScan, SQLMap, Burp Suite, Zed Attack Proxy

#### - [Hutchins et al 2011: Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains](https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf), chapters Abstract, 3.2 Intrusion Kill Chain.

-	Perinteiset verkon suojaustyökalut eivät useinkaan enää ole riittäviä, sillä myös uhat ovat kehittyneet.
-	Tappoketjumalli on lähtöisin USA:n armeijalta ja se kuvaa tunkeutumisen eri vaiheita, joita ovat etsiä, korjata, jäljittää, kohdistaa, alkaa toimia (engage) ja arvioida. Nimensä mukaisesti prosessissa eteneminen edellyttää aiemmissa vaiheissa onnistumista.
- Laajennetun, uudemman määrittelyn mukaan tappoketjumalli on suunniteltu erityisesti tunkeutumista varten. Tällöin sen prosessin vaiheet ovat tiedustelu, aseistus, toimitus, hyödyntäminen, asennus, komento ja valvonta sekä tavoitteita koskevat toimet.


-----------------------------------------------------------

### a) Ratkaise Over The Wire: Bandit kolme ensimmäistä tasoa (0-2).
Peli on ajatukseltaan yksinkertainen ja haasteet löytyvät sivulta: `https://overthewire.org/wargames/bandit/`. Itse peliä pelataan ottamalla ssh yhteys osoitteeseen `bandit.labs.overthewire.org`. Haasteen ratkaistua saa salasanan seuraavalle tasolle. Osassa haasteista löytyy myös avuksi materiaalia, josta voi opetella haasteen ratkaisua. Haasteen ratkettua otetaan salasana talteen ja kirjaudutaan uudelleen seuraavan haasteen tunnuksella.

#### Tehtävä 0: 
Tehtävänä on ainoastaan luoda ssh yhteys palvelimeen bandit.lab.overthewire.org, tunnuksella bandit0 ja salasanalla bandit0, porttiin 2220. Tämä tapahtuu komennolla `ssh bandit0@bandit.lab.overthewire.org -p 2220`. ssh = komento ssh yhtyeyden luomisesta, bandit0 = käyttäjä, @bandit.lab.overthewire.org = palvelin, -p = portin määritys. 

![image](https://github.com/AArmias/pentest/assets/102689055/fe20fb16-c878-432f-bd14-2ac229ca5bc2)


#### Tehtävä 0 -> 1: 
Salasanan kerrotaan löytyvän kirjautumisen jälkeen palvelimelta, kotikansiosta, tiedostosta readme.
Sieltähän se löytyi. Salasana talteen ja kirjaudutaan nyt tunnuksella bandit1.<br>
![image](https://github.com/AArmias/pentest/assets/102689055/ecfdfd0f-0aec-49fd-94ff-05788130ddf9)


#### Tehtävä 1 -> 2: 
Nyt tehtävänä on löytää salasana kotihakemistosta tiedostosta: `"-"`, koska "-" nimistä tiedostoa ei voi tarkastella cat komenolla on sivuille annettu linkki tiedon hakemiseen. [Stackowerflowssa](https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal) kyseistä haastetta on myös lähestytty ja kerrottu, että ratkaisuja voi olla kaksi.  
`cat < -` tai `cat ./-`<br>
![image](https://github.com/AArmias/pentest/assets/102689055/c4abe860-7e8e-4de5-b3f3-0ab7d37d6f11)
Taas salasana talteen ja käyttäjän vaihto bandit2. 

#### Tehtävä 2 -> 3: 
Nyt salasanan on kerrottu piilottelevan tiedostossa nimeltä `spaces in this filename`. Koska tiedostonimi sisältää välejä, ei sitä pysty taas normaalilla cat komennolla tarkastelemaan. 
[Linuxhandbook](https://linuxhandbook.com/filename-spaces-linux/) osaa kertoa parhaaksi tavaksi niputtaa koko tiedosto yhdeksi, pistämällä heittomerkit molemmin puolin. `cat "spaces in this filename"`.<br>
![image](https://github.com/AArmias/pentest/assets/102689055/65dcf54a-7a30-4097-a8a8-21cc13edf25d)
<br>Salasana talteen. 

Peli on hauska ja koukuttava tapa oppia, suosittelen! 


-----------------------------------------------------------

### b) Asenna WebGoat ja kokeile, että pääset kirjautumaan sisään.

Aloitin WebGoatin asentamisen avaamalla yksinkertaiset ohjeet osoitteesta: https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/

Ensimmäinen askel oli päivittää debian tähän päivään. Komennolla `sudo apt-get update` tämä hoituu, jonka jälkeen ohje neuvoi asentamaan seuraavat lisäykset: openjdk 17 (java), ufw (palomuuri), wget (ohjeen myöhemmässä vaiheessa tulevan paketin lataamiseen), bash-completion (lisää komentoja terminaaliin). Lataus tapahtuu käskyllä: `sudo apt-get -y install openjdk-17-jre ufw wget bash-completion` Tällä päästään eteenpäin! 

Seuraava vaihe on käynnistää juudi asennettu UFW palomuuri, tämä tapahtuu komennolla: `sudo ufw enable`. 

Jälellä olisi enää itse webgoatin lataaminen joka onnistuu joko lataamalla se käskyllä: `wget https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/webgoat-server-8.0.0.M26.jar` tai lataamalla kyseinen .jar tiedosto suoraa selaimella. 
Itse WebGoatin asentaminen ja käynnistys tapahtuu käskyllä: `java -jar webgoat-server-8.0.0.M26.jar`.

Nyt Webgoat on toiminnassa, ohjetta noudattaen seuraava vaihe on luoda tunnus ja kirjautua WebGoattiin. Tämä tapahtuu avaamalla osoite `"http://localhost:8080/WebGoat/"` nettiselaimeen. Sivulla on mahdollisuus kirjautua suoraa sisälle tai luoda tunnu. Tunnusta luodessa sivu kysyy käyttäjätunnusta ja 6-10 merkkistä salasanaa. Tunnuksen luonti on varsin nopeaa, kun tunnus on luotu kirjaudutaan sisälle juuri luomilla tunnuksilla, nyt kaikki on valmista itse harjoituksien aloittamiseen! 

-----------------------------------------------------------------

### c) Ratkaise WebGoatista tehtävät "HTTP Basics" ja "Developer tools". Katso vinkit alta.
#### - HTTP Basics:
  Osassa 1 kerrotaan miten nettisivut toimivat ja mikä on perusidea. Joko käsky on GET tai POST, jonka ympärille kaikki rakentuvat. 
  
  Osassa 2 näytetään miten tavallinen nettisivuilta löytyvä kaavake toimii ja annetaan mahdollisuus kokeilla sitä. 
  
  Osassa 3 tulee itse tehtävä. Tehtävässä pyydetään täyttämään ensimmäiseen hakukentän ruutuun "`What type of HTTP command did WebGoat use for this lesson. A POST or a GET."` eli suomennettuna `"Minkä tyyppistä HTTP-komentoa WebGoat käytti tällä oppitunnilla. POST tai GET.`" vastaus ensimmäiseen ruutuun on POST. Mikäli ruutuun syöttää GET saa ilmoituksen väärästä vastauksesta. Kun vastaa oikein, aktivoituu seuraavan kentän vastaus `"You are close, try again: the magic number is incorrect."` Joten oikea taikanumero pitäisi vielä keksiä. Koska kentään mahtuu loputtomasti numeroita on taikanumeron keksimen yksitellen kokeilemalla melko iso prosessi. Jonkin muu ratkaisu on siis keksittävä. 
  
Ensimmäisellä tunkeutumistestauksen tunnilla meille kerrottiin jo siitä, miten Firefoxin F12 näppäin vastaa jo melko hyviä työkaluja perus tunkeutumiseen. Vielä paremman hyödyn tässä tapauksessa saa hiiren oikeaa nappia apuna käyttäen. Klikkaamalla kaavakkeeseen ja painamalla tarkista, ollaan jo melko lähellä ratkaisua. Syötetään hakukenttään mitä massasta yritetään löytää: `"Magic"` ja devtoolsin haku kenttä tarjoaa meille kuin tarjottimella: `"#magic_num"` vaihtoehtoa. Valitaan se html koodin seasta löytyy rivi: `"<input id="magic_num" type="hidden" name=magic_num" value="56">"`
Kenttä kertoo meille taikanumeron arvoksi 56, kokeillaan syöttää tämä luku kaavakkeen kenttään ja huomataan sen toimivan! Tehtävä suoritettu! 

#### - Developer Tools

Developer Toolsin 3 ensimmäistä vaihetta sisältää oppimateriaali siitä miten työkalu toimii. Neljännessä osiossa tulee ensimmäinen tehtävä ratkaistavaksi. Tehtävä pyytää dev toolsin consoliin kirjoittamaan komennon `webgoat.customjs.phoneHome()`. Kun komentoa koittaa syöttää consoliin saa vastaukseksi varoitus viestin ja ohjeet, miten varoituksen saa pois päältä, tämä tapahtuu kirjoittamalla `allow pasting` consoliin.

![image](https://github.com/AArmias/pentest/assets/102689055/e09bef04-6377-479a-a5d4-c569868db5fe)

Seuraavassa tehtävä pitää avata network välilehti dev toolsista. Ohjeena on painaa Go! nappia ja löytää HTTP request joka pitää sisällään `networkNum:`nimisen kentän. 
![image](https://github.com/AArmias/pentest/assets/102689055/6a525ef5-0b0a-4c1d-a795-ade2fdf0bf16)
Vastauksen löytäminen oli yllättävän helppoa. 





-----------------------------------

### d) Ratkaise ja selitä PortSwigger Labs: Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data. (Edellyttää ilmaista rekisteröitymistä. Tehtävän voi ratkaista pelkästään selaimen osoitekenttää muokkaamalla.) Selitä, mitä tekniikoita kokeilit, ja mitä hyökkäyksesi eri osat tekevät.


### e) Asenna Linux virtuaalikoneeseen. Suosittelen joko Kali (viimeisin versio) tai Debian 12-Bookworm. 

Aloitin asentamisen ottamalla tueksi nämä ohjeet: [Install Debian on Virtualbox](https://terokarvinen.com/2021/install-debian-on-virtualbox/).
Asensin windows koneelleni Oracle VM VirtualBoxin uusimman version 7.0 ja latasin Debian 12.5 iso tiedoston.
Koska jo aiemmilla kursseilla on useamman kerran tullut erinäisiä hiekkalaatikkokoneita asenettua, oli asennus jotenkin muistissa. Suurin ero ehkä oli siinä, että aiemmin olen käyttänyt ubuntua. Nyt asennettava versio on Debian. 
![image](https://github.com/AArmias/pentest/assets/102689055/e9880f48-c84b-4386-be00-8413d38713e7)
Muutoksena edelliseen asennukseen VirtualBox tarjoaa asennus vaiheessa nykyään Unattended installation vaihdoehdon. Koska en tähän ole tarkemmin perehtynyt, laitoin rastin ruutuun tämän ohittamiseksi. 

<br>Seuraavaksi säädetään hardware asetukset kuntoon, eli muistin määrä ja virtuaalisen kovalevyn koko. 
![image](https://github.com/AArmias/pentest/assets/102689055/696b06cf-8aa7-43db-b4d8-08736dab2e4f)
![image](https://github.com/AArmias/pentest/assets/102689055/5b01d200-44a7-4e17-bae0-04eb069d3717)

Seuraavana vuorossa on itse asennus: 
![image](https://github.com/AArmias/pentest/assets/102689055/36c34825-b647-4d1f-a5c2-48fcc2c662c7)
Tällä kertaa valitsin graaffisen asennuksen, joka opastaa kohda kohdalta läpi asennuksen. 
Aluksi kysellään Kieli, sijainti ja näppäimmistö asiat kuntoon. Englanti kieleksi, sijainti suomeen ja kieleksi suomi. 

Seuraavaksi on vuorossa root käyttäjän salasanan määritys: 
![image](https://github.com/AArmias/pentest/assets/102689055/155f6243-902c-4383-b880-28e70a1f4a7e)
ja käyttäjän luominen ja salasanan asettaminen käyttäjälle. 

Sitten on vuorossa useampi next tai continue naputtelu ja lopulta tulee ilmoitus, että asennus on valmis ja virtuali kone pitää käynnistää uudelleen. 
![image](https://github.com/AArmias/pentest/assets/102689055/230313f0-7667-451b-a70b-34257b0a20d4)

Nyt asennus on valmis: 
![image](https://github.com/AArmias/pentest/assets/102689055/905b0ce5-fc24-4f72-9a7c-7294ed8139a8)

Mikäli linuxin asentamiseen haluaa tutustua tarkemmin löytyy lisää infoa asennuksen alusta löytyvästä Tero Karvisen ohjeesta tai vaikkapa aiemmalla kurssilla tekemästäni raportista: https://github.com/AArmias/Linuxpalvelimet22/blob/main/h1.md



----------

### f) Porttiskannaa 1000 tavallisinta tcp-porttia omasta koneestasi (localhost). Analysoi tulokset. 
Tätä tehtävää varten asensin ensimmäisessä tehtävässä tutuksi tulleen nmap nimisen työkalun, juuri edellisessä tehtävässä asentamalleni virtuaalikoneelle Debian 12 virtuaalikoneelle. Nopeasti nmapin manuaalista selviää, että perus skannauksella työkalu suorittaa skannauksen 1000 tavallisimpaan tcp-porttiin. 
![image](https://github.com/AArmias/pentest/assets/102689055/76f8f4a7-007e-454b-a21f-a3974896c394)

Ennen testin suorittamista katkaisin virtuaalikoneestani yhteydet ulospäin verkkoasetuksista, jotta mitään vahinkoa ei pääse tapahtumaan. Itse skannauksen tein käskyllä `sudo nmap localhost` ja vastaukseksi sain: 
![image](https://github.com/AArmias/pentest/assets/102689055/62327424-518d-4bf2-aca6-2a80e80a854f)
999 porttia on kiinni ja portti 631/tcp on auki. Aluksi luulin, että tähän vaikutti virtuaalikoneelle asennettu ja aktivoitu ufw palomuuri. 

Kokeilin kuitenkin kytkeä ufw:n pois päältä ja suorittaa skannauksen uudelleen. 
![image](https://github.com/AArmias/pentest/assets/102689055/452ff1e2-a323-43d1-b170-13f9974fea7e)
<br>Lopputulos oli kuitenkin sama. 999 suljettua porttia ja avonaisena tuo 631/tcp. Ilmeisesti tuo portti 631/tcp on jokin universaali printteri portti ja käskyttää printtereitä printtaamaan vähän turhakin hanakasti, joten tämän takia tuota porttia ei suositella skannattavaksi. 
![image](https://github.com/AArmias/pentest/assets/102689055/13131937-7eb2-41d8-8486-ab14180dd49d)

-----------------------------------------

### g) Porttiskannaa kaikki koneesi (localhost) tcp-portit. Analysoi tulokset. (Edellisissä kohdissa mainittuja analyyseja ei tarvitse toistaa, voit vain viitata niihin ja keskittyä eroihin).
Kaikkien porttien skannaukseen komentona toimii `sudo nmap -p- localhost`
![image](https://github.com/AArmias/pentest/assets/102689055/d39bf86c-f623-4e0f-b2aa-259eb20072d5)<br>
Tällä kertaa suljettujen porttimäärä kasvoi 999 portista 65534 porttiin. Muilta osin skannaus vastasi edellistä 999 portin skannaustakin. 

------------------------------------------

### h) Tee laaja porttiskanaus (nmap -A) omalle koneellesi (localhost), kaikki portit. Selitä, mitä -A tekee. Analysoi tulokset. (Edellisissä kohdissa mainittuja analyyseja ei tarvitse toistaa, voit vain viitata niihin ja keskittyä eroihin.).



i) Asenna demoni tai pari (esim Apache ja SSH). Vertaile, miten localhost:n laajan porttiskannauksen tulos eroaa.
j) Kokeile ja esittele jokin avointen lähteiden tiedusteluun sopiva weppisivu tai työkalu. Hyviä esimerkkejä löytyy Bazzel: IntelTechniques: Tools ja Bellingcat: Resources, voit myös käyttää muuta itse valitsemaasi työkalua. Työkalua pitää siis myös kokeilla, pelkkä nimen mainitseminen ei riitä. Pidä esimerkit harmittomina, älä julkaise kenenkään henkilökohtaisia salaisuuksia raportissasi.


### Lähteet: 
Tunkeutumistestaus 2024 - https://terokarvinen.com/2024/eettinen-hakkerointi-2024/<br>
How to Use SSH - https://www.wikihow.com/Use-SSH<br>
Bandit - https://overthewire.org/wargames/bandit/<br>
How to open a "-" dashed filename using terminal? - https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal<br>
How to Tackle Filenames With Spaces in Linux - https://linuxhandbook.com/filename-spaces-linux/<br>
Install Debian on Virtualbox- https://terokarvinen.com/2021/install-debian-on-virtualbox/<br>
nmap -  https://nmap.org/<br>
masscan - https://github.com/robertdavidgraham/masscan<br>
EyeWitness - https://github.com/ChrisTruncer/EyeWitness-Ruby
