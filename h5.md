## h5 Täysin Laillinen Sertifikaatti


### x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva kustakin artikkelista. Kannattaa lisätä myös jokin oma ajatus, idea, huomio tai kysymys.)
  
  #### OWASP 2021: OWASP Top 10:2021
    - A01:2021 – Broken Access Control (IDOR ja path traversal ovat osa tätä)
    - A10:2021 – Server-Side Request Forgery (SSRF)

  #### PortSwigget Academy:
    - Insecure direct object references (IDOR)
    - Path traversal
    - Server-side template injection
    - Server-side request forgery (SSRF)
    - Cross-site scripting

  #### Karvinen 2020: Using New Webgoat 2023.4 to Try Web Hacking


------------------------------------------------------------

### a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimi localhost:lla ilman Foxyproxya)

#### Asenna OWASP ZAP.
Aloitin tehtävän asentamalla Zaproxy eli ZAP. Tätä ehdittiin jo tunnilla käydä läpi ja tapoja oli muutama. Joko suoraa paketinhallinnan kautta kuten alla tai vaihtoehtoisesti ZAPin omilta lataus sivuilta - [Download ZAP](https://www.zaproxy.org/download/). Sivuilta löytyy installer versio ja packet versio.  

    $ sudo apt-get install zaproxy

![image](https://github.com/AArmias/pentest/assets/102689055/73159058-5c05-4bce-bb0d-fe70ec391098)

Kas näin, nyt meillä on ZAP asennettuna. 

![image](https://github.com/AArmias/pentest/assets/102689055/45eead64-b3dc-47d1-8e8f-d7e0dde18215)

#### Generoi CA-sertifikaatti ja asenna se selaimeesi.
Nyt CA-sertifikaatin pariin. Tämä osuus käytiin yhdessä tunnilla läpi, joten asetuksen säätämiseen ei tarinnut kaivella nettiä läpi. Asetus löytyy `Options -> Network -> Server Certificates` tai `Options` ja hakukenttään `Certificates`.

![image](https://github.com/AArmias/pentest/assets/102689055/11bbf62c-c337-4ddd-93b0-48444552a8fb)


HUOM! Aiemmin tämä asetus löytyi kohdasta `Dynamic SSL Certificates` mutta nyt siellä on seuraava ilmoitus ja linkki eteenpäin: 

![image](https://github.com/AArmias/pentest/assets/102689055/127f1d4b-2c9c-44e4-a1fc-b279d742c0a6)

Painetaan generate.

![image](https://github.com/AArmias/pentest/assets/102689055/a71ec629-273f-4302-887c-3dc57e6e545e)

Yes. 

Valitaan Save ja tallennetaan sertifikaatti. 

![image](https://github.com/AArmias/pentest/assets/102689055/a146f75b-1ba6-4f6e-86c1-2c91ff27bdc5)

Nyt meillä on CA sertifikaatti luotuna, lisätään se firefoxiin. 

Käynnistetään firefox ja otetaan oikealta kulmasta valikko auki. Settings -> Privacy - Security -> Certificates -> View Certificates ja Import... 

![image](https://github.com/AArmias/pentest/assets/102689055/56bb23c1-7353-467c-a226-ed8fcd94c399)

![image](https://github.com/AArmias/pentest/assets/102689055/9be23097-08ac-4927-80cc-d97d6dc70ccb)

Etsitään kotihakemistosta aiemmin tallennettu sertifikaatti `zap_root_ca.cer` -> Open


`Trust this CA to identify websites.` -> OK 
![image](https://github.com/AArmias/pentest/assets/102689055/a3076eca-bbb1-4bf0-992e-97b325d37b73)

![image](https://github.com/AArmias/pentest/assets/102689055/71a89237-3445-42a5-8c3c-117535a14b59)

Sieltä löytyy! 

#### Laita ZAP proxyksi selaimeesi.

Avataan Firefoxin asetukset: Settings -> General -> Network Settings -> Settings...
![image](https://github.com/AArmias/pentest/assets/102689055/3cbca2d9-3640-4365-bf15-e2d03df5ee47)

Asetetaan manuaalisesti osoitteeksi `localhost` ja portiksi `8080` jossa ZAProxy operoi. -> OK. 

![image](https://github.com/AArmias/pentest/assets/102689055/9c13a91c-d4d0-428d-9ec5-fefe2a9afbfa)

Kokeillaan avata wikipedia ja katsotaan toimiiko Zap. 

![image](https://github.com/AArmias/pentest/assets/102689055/6d055c87-4fcd-4b80-95e4-0e0546312177)


Zap toimii selaimessa!  


#### Laita ZAP sieppaamaan myös kuvat. 

Asetus löytyy Options -> Display -> `Process images in HTTP requests/responses` merkki ruutuun ja OK. 

![image](https://github.com/AArmias/pentest/assets/102689055/9befc589-a513-4444-9291-33dc290ed3ca)

#### Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään.

Avattiin Reddit ja päällä oli Zapin Safemode kaiken varalta. Liikenne näkyi Zapin puolella heti. 
![image](https://github.com/AArmias/pentest/assets/102689055/887d38db-4b7f-4e27-bbcc-0ad2f3c4da0e)

-------------------------------------------------------------------------------------------------


### b) Kettumaista. Asenna FoxyProxy Standard Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)

FoxyProxy on selainlaajennus joten se löytyy sieltä mistä firefoxin muutkin selainlaajennukset eli addonit on saatavilla. Tarjolla on useampi vaihtoehto, nyt ohjeena oli asentaa standard versio. 
![image](https://github.com/AArmias/pentest/assets/102689055/db5bc9cc-f5a8-4940-b256-8ed9d0bebd75)

Standar versio löytyi ja asennetaan se. 
![image](https://github.com/AArmias/pentest/assets/102689055/043aa0c0-7a49-405e-a466-5a4b991bb15d)

Laitetaan ZAPorxyn asetukset FoxyProxyyn. 
Nimi: ZAP, Hostname: Localhost, Port 8080 samat jotka löytyvät Zapin alereunasta. 
![image](https://github.com/AArmias/pentest/assets/102689055/5fdd9b99-7367-450b-8c54-ff0b0918f3a9)

![image](https://github.com/AArmias/pentest/assets/102689055/705f1d1e-f971-4403-b37f-e05754fec407)

#### Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn.
Koska Patternsit asetetaan suoraa käytössä olevalle proxylle (ZAP), löytyy Patterns asetukset FoxyProxyn omista asetuksista `Proxies` välilehdeltä ZAPorxyn asetuksien alta. 
Lisätään: "(Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)". 
![image](https://github.com/AArmias/pentest/assets/102689055/1f2e000b-58fd-40f7-a08d-25e56044b371)

Otetaan Foxyproxyn profiilista `Proxy by Patterns` profiili käyttöön. 
![image](https://github.com/AArmias/pentest/assets/102689055/f1335bed-5bdc-46fe-a13e-68a04c339e4e)
Nyt kun päivitetään 2 selainta, toinen jossa on Reddit ja toinen jossa on Portswigger, ei reddit:n get pyynnöt tule enää läpi, ainoastaan Portswiggerin pyynnöt. 
![image](https://github.com/AArmias/pentest/assets/102689055/ba771ba5-090a-4a0f-adf4-fe1789c14242)



---------------------------------------------------------

### PortSwigger Labs. Ratkaise tehtävät. Selitä ratkaisusi: mitä palvelimella tapahtuu, mitä eri osat tekevät, miten hyökkäys löytyi, mistä vika johtuu. Kannattaa käyttää ZAPia, vaikka malliratkaisut käyttävät harjoitusten tekijän maksullista ohjelmaa. Malliratkaisun kopioiminen ZAP:n tai selaimeen ei ole vastaus tehtävään, vaan ratkaisu ja haavoittuvuuden etsiminen on selitettävä ja perusteltava.

### Insecure Direct Object Reference (IDOR)
#### c) Insecure direct object references

### Path traversal
#### d) File path traversal, simple case

#### e) File path traversal, traversal sequences blocked with absolute path bypass

#### f) File path traversal, traversal sequences stripped non-recursively

### Server Side Template Injection (SSTI)
#### g) Server-side template injection with information disclosure via user-supplied objects (Tämä on merkitty hieman vaikeammaksi, jätä viimeiseksi jos näyttää hankalalta)
Server Side Request Forgery (SSRF)

#### h) Basic SSRF against the local server

### Cross Site Scripting (XSS)
#### i) Reflected XSS into HTML context with nothing encoded

#### j) Stored XSS into HTML context with nothing encoded

---------------------------

### k) Asenna Webgoat 2023.4. (Uusi versio, jossa on eri tehtäviä kuin vanhemmissa. Jos olet jo asentanut sen, ei tarvitse raportoida asennusta uudelleen; raportoi silloin vain pelkkä testi, jolla toteat sen toimivaksi.)

Olimme ensimmäisessä kotitehtävässä asentanteet vanhemman Webgoat version, joten uuden version asentaminen oli edessä. 
Ohjeet asennukseen löytyi Tero karvisen julkaisusta: [Try Web Hacking on New Webgoat 2023.4](https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/).

Normaali lähtötapa eli paketit päivitykseen: 
    
    $ sudo apt-get update
Lisäksi asennetaan java laajennus, mikäli sitä ei ole:     
    
    $ sudo apt-get install openjdk-17-jre
Itsellä tällä kertaa java laajennus oli valmiina. 

![image](https://github.com/AArmias/pentest/assets/102689055/fa2a4549-b1f2-421e-ad5d-af18b21bf02e)

Palomuurin asennus ja käynnistys, mikäli sitä ei ole tehnyt: 

    $ sudo apt-get install ufw
    $ sudo ufw enable

Itselläni palomuuri jo kävi ja kukkui valmiiksi. 

![image](https://github.com/AArmias/pentest/assets/102689055/7d20dec8-72f8-4da0-ba6f-abaddb1fb134)

Mikäli wget ei ole asennettuna on se hyvä tehdä tässä vaiheessa: 

    $ sudo apt-get install wget

sekin löytyi tällä kertaa jo valmiiksi. 

![image](https://github.com/AArmias/pentest/assets/102689055/926dcb3c-2bd2-40cb-83bc-5acae366ba1e)

Sitten Webgoat 2023.4. paketin lataus: 

    $ wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar

![image](https://github.com/AArmias/pentest/assets/102689055/1b5ad8b8-3edf-40f6-9e9d-b28f966a8a9f)

Koska Webgoat harjoituksia tehdessä koneella tullaan saman aikaisesti ajamaan ZAP välimiesproxyä, joka käyttää porttia 8080 samoin kuin Webgoat tekisi, vaihdetaan WebGoatin portti 8888 ja Webwolfin 9090. 
Samalla käynnistetään Webgoat käyttöä varten. 

    $ java -Dfile.encoding=UTF-8 -Dwebgoat.port=8888 -Dwebwolf.port=9090 -jar webgoat-2023.4.jar

![image](https://github.com/AArmias/pentest/assets/102689055/e0720e62-4cc9-43fb-b879-5526512bd2d6)

Mikäli asennus on onnistunut nyt meillä pitäisi olla WebGoat päällä. Tarkistetaan se menemällä osoitteeseen: `http://127.0.0.1:8888/WebGoat`

![image](https://github.com/AArmias/pentest/assets/102689055/40e12dbf-83f9-4be2-a920-e24cede44446)

Käynnissä on. 

Nyt vuorossa on käyttäjän luonti ja harjoituksen aloitus. 

![image](https://github.com/AArmias/pentest/assets/102689055/c2ebf509-8890-4bf5-8f44-8068f1225d30)

![image](https://github.com/AArmias/pentest/assets/102689055/f2bf0e24-50ea-4339-9802-7b16d9cb569d)


----------------------------------------------------------------------------------------------------








### l) Asenna pencode ja muunna sillä jokin merkkijono (encode a string).

Jotta sain asennettua pencoden tuli ensiksi asentaa paketillinen Go ohjelmointikieltä. 

    sudo apt-get -y install golango-go
  Testataan myös asennuksen jälkeen löytyykö kieli nyt: 

    go version
![image](https://github.com/AArmias/pentest/assets/102689055/8ba66eba-3793-4f10-b628-a0a2943f7458)

Nyt githupista löytyvät asennus ohjeet toimivat: 

    go install github.com/ffuf/pencode/cmd/pencode@latest
![image](https://github.com/AArmias/pentest/assets/102689055/a49ac306-cc14-4848-9589-47b4791e5dc0)





------------------------------------------------------------------

### Ratkaise WebGoat 2023.4:
#### m) (A1) Broken Access Control (WebGoat 2023.4. Pitää olla nimenomaan tämä versio. Eri versioissa on eri tehtävät.)
    - Hijack a session (1) [vaikea]
    - Insecure Direct Object References (4) [vaikeita kohtia]
    - Missing Function Level Access Control (2) [Ei kohtaa 4 "The company fixed the problem, right?", se saattaa olla rikki]

#### n) (A7) Identity & Auth Failure (WebGoat 2023.4)
    - Authentication Bypasses (1)
    - Insecure Login (1)

#### o) (A10) Server-side Request Forgery (WebGoat 2023.4)
    - Server-Side Request Forgery (2)

#### p) Client side (WebGoat 2023.4)
    - Bypass front-end restrictions (2)

----------------------------------------------------------------------
### Lähteet:
- Try Web Hacking on New Webgoat 2023.4 - https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/
- Tunkeutumistestaus 2024 - https://terokarvinen.com/2024/eettinen-hakkerointi-2024/
- Pencode - https://github.com/ffuf/pencode
- Zed Attack Proxy https://www.zaproxy.org/
